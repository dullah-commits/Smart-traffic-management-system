import { $ as Amplify, A as deserializeJsonToPkcCreationOptions, B as DEFAULT_SERVICE_CLIENT_API_CONFIG, C as confirmResetPassword, D as autoSignIn, E as signIn, F as PasskeyErrorCode, G as getCurrentUser, H as createUserPoolDeserializer, I as assertPasskeyError, J as AuthError, K as assertAuthTokens, L as passkeyErrorMap, M as getIsPasskeySupported, N as handlePasskeyError, O as assertCredentialIsPkcWithAuthenticatorAttestationResponse, P as PasskeyError, Q as fetchAuthSession, S as resendSignUpCode, T as signUp, U as createUserPoolSerializer, V as cognitoUserPoolTransferHandler, W as getAuthUserAgentValue, Z as composeServiceApi, _ as verifyTOTPSetup, a as rememberDevice, b as confirmSignIn, c as sendUserAttributeVerificationCode, d as signInWithRedirect, et as AuthAction, f as confirmUserAttribute, g as updatePassword, h as setUpTOTP, i as forgetDevice, j as serializePkcWithAttestationToJson, k as assertValidCredentialCreationOptions, l as signOut, m as updateUserAttributes, nt as assertTokenProviderConfig, o as deleteUser, p as updateUserAttribute, q as getRegionFromUserPoolId, r as fetchDevices, rt as decodeJWT, s as deleteUserAttributes, u as fetchUserAttributes, v as fetchMFAPreference, w as resetPassword, x as confirmSignUp, y as updateMFAPreference, z as createCognitoUserPoolEndpointResolver } from "./credentialsProvider-h6KNbopY.js";

//#region node_modules/@aws-amplify/auth/dist/esm/client/utils/passkey/errors/handlePasskeyRegistrationError.mjs
/**
* Handle Passkey Registration Errors
* https://w3c.github.io/webauthn/#sctn-create-request-exceptions
*
* @param err unknown
* @returns PasskeyError
*/
var handlePasskeyRegistrationError = (err) => {
	if (err instanceof PasskeyError) return err;
	if (err instanceof Error) {
		if (err.name === "InvalidStateError") {
			const { message, recoverySuggestion } = passkeyErrorMap[PasskeyErrorCode.PasskeyAlreadyExists];
			return new PasskeyError({
				name: PasskeyErrorCode.PasskeyAlreadyExists,
				message,
				recoverySuggestion,
				underlyingError: err
			});
		}
		if (err.name === "NotAllowedError") {
			const { message, recoverySuggestion } = passkeyErrorMap[PasskeyErrorCode.PasskeyRegistrationCanceled];
			return new PasskeyError({
				name: PasskeyErrorCode.PasskeyRegistrationCanceled,
				message,
				recoverySuggestion,
				underlyingError: err
			});
		}
	}
	return handlePasskeyError(err);
};

//#endregion
//#region node_modules/@aws-amplify/auth/dist/esm/client/utils/passkey/registerPasskey.mjs
/**
* Registers a new passkey for user
* @param input - PasskeyCreateOptionsJson
* @returns serialized PasskeyCreateResult
*/
var registerPasskey = async (input) => {
	try {
		assertPasskeyError(getIsPasskeySupported(), PasskeyErrorCode.PasskeyNotSupported);
		const passkeyCreationOptions = deserializeJsonToPkcCreationOptions(input);
		const credential = await navigator.credentials.create({ publicKey: passkeyCreationOptions });
		assertCredentialIsPkcWithAuthenticatorAttestationResponse(credential);
		return serializePkcWithAttestationToJson(credential);
	} catch (err) {
		throw handlePasskeyRegistrationError(err);
	}
};

//#endregion
//#region node_modules/@aws-amplify/auth/dist/esm/foundation/factories/serviceClients/cognitoIdentityProvider/createStartWebAuthnRegistrationClient.mjs
var createStartWebAuthnRegistrationClient = (config) => composeServiceApi(cognitoUserPoolTransferHandler, createUserPoolSerializer("StartWebAuthnRegistration"), createUserPoolDeserializer(), {
	...DEFAULT_SERVICE_CLIENT_API_CONFIG,
	...config
});

//#endregion
//#region node_modules/@aws-amplify/auth/dist/esm/foundation/factories/serviceClients/cognitoIdentityProvider/createCompleteWebAuthnRegistrationClient.mjs
var createCompleteWebAuthnRegistrationClient = (config) => composeServiceApi(cognitoUserPoolTransferHandler, createUserPoolSerializer("CompleteWebAuthnRegistration"), createUserPoolDeserializer(), {
	...DEFAULT_SERVICE_CLIENT_API_CONFIG,
	...config
});

//#endregion
//#region node_modules/@aws-amplify/auth/dist/esm/client/apis/associateWebAuthnCredential.mjs
/**
* Registers a new passkey for an authenticated user
*
* @returns Promise<void>
* @throws - {@link PasskeyError}:
* - Thrown when intermediate state is invalid
* @throws - {@link AuthError}:
* - Thrown when user is unauthenticated
* @throws - {@link StartWebAuthnRegistrationException}
* - Thrown due to a service error retrieving WebAuthn registration options
* @throws - {@link CompleteWebAuthnRegistrationException}
* - Thrown due to a service error when verifying WebAuthn registration result
*/
async function associateWebAuthnCredential() {
	const authConfig = Amplify.getConfig().Auth?.Cognito;
	assertTokenProviderConfig(authConfig);
	const { userPoolEndpoint, userPoolId } = authConfig;
	const { tokens } = await fetchAuthSession();
	assertAuthTokens(tokens);
	const { CredentialCreationOptions: credentialCreationOptions } = await createStartWebAuthnRegistrationClient({ endpointResolver: createCognitoUserPoolEndpointResolver({ endpointOverride: userPoolEndpoint }) })({
		region: getRegionFromUserPoolId(userPoolId),
		userAgentValue: getAuthUserAgentValue(AuthAction.StartWebAuthnRegistration)
	}, { AccessToken: tokens.accessToken.toString() });
	assertValidCredentialCreationOptions(credentialCreationOptions);
	const cred = await registerPasskey(credentialCreationOptions);
	await createCompleteWebAuthnRegistrationClient({ endpointResolver: createCognitoUserPoolEndpointResolver({ endpointOverride: userPoolEndpoint }) })({
		region: getRegionFromUserPoolId(userPoolId),
		userAgentValue: getAuthUserAgentValue(AuthAction.CompleteWebAuthnRegistration)
	}, {
		AccessToken: tokens.accessToken.toString(),
		Credential: cred
	});
}

//#endregion
//#region node_modules/@aws-amplify/auth/dist/esm/foundation/factories/serviceClients/cognitoIdentityProvider/createListWebAuthnCredentialsClient.mjs
var createListWebAuthnCredentialsClient = (config) => composeServiceApi(cognitoUserPoolTransferHandler, createUserPoolSerializer("ListWebAuthnCredentials"), createUserPoolDeserializer(), {
	...DEFAULT_SERVICE_CLIENT_API_CONFIG,
	...config
});

//#endregion
//#region node_modules/@aws-amplify/auth/dist/esm/foundation/apis/listWebAuthnCredentials.mjs
async function listWebAuthnCredentials$1(amplify, input) {
	const authConfig = amplify.getConfig().Auth?.Cognito;
	assertTokenProviderConfig(authConfig);
	const { userPoolEndpoint, userPoolId } = authConfig;
	const { tokens } = await amplify.Auth.fetchAuthSession();
	assertAuthTokens(tokens);
	const { Credentials: commandCredentials = [], NextToken: nextToken } = await createListWebAuthnCredentialsClient({ endpointResolver: createCognitoUserPoolEndpointResolver({ endpointOverride: userPoolEndpoint }) })({
		region: getRegionFromUserPoolId(userPoolId),
		userAgentValue: getAuthUserAgentValue(AuthAction.ListWebAuthnCredentials)
	}, {
		AccessToken: tokens.accessToken.toString(),
		MaxResults: input?.pageSize,
		NextToken: input?.nextToken
	});
	return {
		credentials: commandCredentials.map((item) => ({
			credentialId: item.CredentialId,
			friendlyCredentialName: item.FriendlyCredentialName,
			relyingPartyId: item.RelyingPartyId,
			authenticatorAttachment: item.AuthenticatorAttachment,
			authenticatorTransports: item.AuthenticatorTransports,
			createdAt: item.CreatedAt ? /* @__PURE__ */ new Date(item.CreatedAt * 1e3) : void 0
		})),
		nextToken
	};
}

//#endregion
//#region node_modules/@aws-amplify/auth/dist/esm/client/apis/listWebAuthnCredentials.mjs
/**
* Lists registered credentials for an authenticated user
*
* @param {ListWebAuthnCredentialsInput} input The list input parameters including page size and next token.
* @returns Promise<ListWebAuthnCredentialsOutput>
* @throws - {@link AuthError}:
* - Thrown when user is unauthenticated
* @throws - {@link ListWebAuthnCredentialsException}
* - Thrown due to a service error when listing WebAuthn credentials
*/
async function listWebAuthnCredentials(input) {
	return listWebAuthnCredentials$1(Amplify, input);
}

//#endregion
//#region node_modules/@aws-amplify/auth/dist/esm/foundation/factories/serviceClients/cognitoIdentityProvider/createDeleteWebAuthnCredentialClient.mjs
var createDeleteWebAuthnCredentialClient = (config) => composeServiceApi(cognitoUserPoolTransferHandler, createUserPoolSerializer("DeleteWebAuthnCredential"), createUserPoolDeserializer(), {
	...DEFAULT_SERVICE_CLIENT_API_CONFIG,
	...config
});

//#endregion
//#region node_modules/@aws-amplify/auth/dist/esm/foundation/apis/deleteWebAuthnCredential.mjs
async function deleteWebAuthnCredential$1(amplify, input) {
	const authConfig = amplify.getConfig().Auth?.Cognito;
	assertTokenProviderConfig(authConfig);
	const { userPoolEndpoint, userPoolId } = authConfig;
	const { tokens } = await amplify.Auth.fetchAuthSession();
	assertAuthTokens(tokens);
	await createDeleteWebAuthnCredentialClient({ endpointResolver: createCognitoUserPoolEndpointResolver({ endpointOverride: userPoolEndpoint }) })({
		region: getRegionFromUserPoolId(userPoolId),
		userAgentValue: getAuthUserAgentValue(AuthAction.DeleteWebAuthnCredential)
	}, {
		AccessToken: tokens.accessToken.toString(),
		CredentialId: input.credentialId
	});
}

//#endregion
//#region node_modules/@aws-amplify/auth/dist/esm/client/apis/deleteWebAuthnCredential.mjs
/**
* Delete a registered credential for an authenticated user by credentialId
* @param {DeleteWebAuthnCredentialInput} input The delete input parameters including the credentialId
* @returns Promise<void>
* @throws - {@link AuthError}:
* - Thrown when user is unauthenticated
* @throws - {@link DeleteWebAuthnCredentialException}
* - Thrown due to a service error when deleting a WebAuthn credential
*/
async function deleteWebAuthnCredential(input) {
	return deleteWebAuthnCredential$1(Amplify, input);
}

//#endregion
export { AuthError, associateWebAuthnCredential, autoSignIn, confirmResetPassword, confirmSignIn, confirmSignUp, confirmUserAttribute, decodeJWT, deleteUser, deleteUserAttributes, deleteWebAuthnCredential, fetchAuthSession, fetchDevices, fetchMFAPreference, fetchUserAttributes, forgetDevice, getCurrentUser, listWebAuthnCredentials, rememberDevice, resendSignUpCode, resetPassword, sendUserAttributeVerificationCode, setUpTOTP, signIn, signInWithRedirect, signOut, signUp, updateMFAPreference, updatePassword, updateUserAttribute, updateUserAttributes, verifyTOTPSetup };
//# sourceMappingURL=aws-amplify_auth.js.map